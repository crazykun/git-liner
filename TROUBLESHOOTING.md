# 故障排除指南

## 问题：点击提交后显示空页面

### 原因分析
这个问题通常由以下几个原因造成：

1. **Git仓库问题**: 当前工作区不是Git仓库
2. **Hash问题**: 使用了截断的hash而不是完整的hash
3. **文件路径问题**: 相对路径或绝对路径不正确
4. **Git命令失败**: Git命令执行失败但没有正确处理错误

### 解决方案

#### 1. 确保在Git仓库中测试
```bash
# 检查是否是Git仓库
git status

# 如果不是，初始化Git仓库
git init
git add .
git commit -m "初始提交"
```

#### 2. 检查插件修复
我们已经修复了以下问题：
- ✅ 使用完整hash (`fullHash`) 而不是截断hash
- ✅ 添加了详细的错误处理和日志
- ✅ 改进了差异显示逻辑
- ✅ 添加了对新增/删除文件的特殊处理

#### 3. 调试步骤
1. 打开VSCode开发者工具 (Help → Toggle Developer Tools)
2. 查看Console面板的错误信息
3. 使用插件时观察控制台输出

#### 4. 测试Git命令
在项目根目录运行测试脚本：
```bash
node test-git.js
```

### 常见错误及解决方法

#### 错误1: "不是 git 仓库"
```
致命错误：不是 git 仓库（或者直至挂载点 / 的任何父目录）
```
**解决**: 在Git仓库中打开文件，或初始化Git仓库

#### 错误2: "该提交中没有找到文件的变更内容"
**原因**: 
- 文件在该提交中没有变更
- 文件路径不正确
- 使用了错误的hash

**解决**: 
- 检查文件是否在该提交中有变更
- 确认文件路径正确

#### 错误3: 空白差异页面
**原因**: Git命令返回空内容
**解决**: 
- 检查Git命令是否正确执行
- 查看开发者工具中的错误信息

### 验证修复

#### 测试步骤
1. 在VSCode中打开插件项目
2. 按F5启动调试
3. 在新窗口中打开一个Git仓库的文件
4. 右键选择"显示文件修改历史"
5. 点击列表中的任意提交
6. 应该看到包含提交信息和差异的页面

#### 预期结果
差异页面应该显示：
```
提交: [完整hash]
作者: [作者名] <[邮箱]>
日期: [日期时间]

[提交消息]

================================================================================

[文件差异内容]
```

### 开发者工具调试

#### 启用详细日志
在`src/gitHistoryProvider.ts`中已添加console.log语句：
```typescript
console.log(`执行命令: git show ${commitHash} -- "${relativePath}"`);
console.log(`工作目录: ${cwd}`);
```

#### 查看日志
1. 打开VSCode开发者工具
2. 切换到Console标签
3. 使用插件功能
4. 观察命令执行情况

### 进一步改进建议

如果问题仍然存在，可以考虑：

1. **添加更多错误处理**
2. **实现Git API而不是命令行**
3. **添加用户配置选项**
4. **支持更多Git操作**

### 联系支持

如果问题仍未解决，请提供：
1. VSCode版本
2. Git版本
3. 操作系统信息
4. 开发者工具中的错误信息
5. 具体的复现步骤